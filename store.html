<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARENA STORE  âš¡ - Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­ÙˆØ´</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffd700; --bg: #0a0a0a; --card: #151515; --main: #0f0; --danger: #ff003c; }
        
        body {
            background: var(--bg); color: white; font-family: 'Cairo', sans-serif;
            margin: 0; padding: 20px; text-align: center;
        }

        header {
            background: linear-gradient(180deg, #1a1a1a, var(--bg));
            padding: 30px 10px; border-bottom: 2px solid var(--gold);
            margin-bottom: 30px; border-radius: 0 0 30px 30px;
            position: relative;
        }

        .back-btn {
            position: absolute; top: 20px; right: 20px;
            background: #222; color: white; border: 1px solid #444;
            padding: 8px 15px; border-radius: 10px; cursor: pointer;
            text-decoration: none; font-weight: bold; font-size: 0.9rem;
        }

        .gold-status {
            font-size: 1.5rem; font-weight: 900; color: var(--gold);
            background: rgba(255, 215, 0, 0.1); display: inline-block;
            padding: 10px 25px; border-radius: 50px; border: 1px solid var(--gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        .store-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .skill-item {
            background: var(--card); border: 2px solid #222;
            padding: 15px 10px; border-radius: 20px;
            transition: 0.3s; position: relative;
            display: flex; flex-direction: column; align-items: center;
        }

        .skill-item:hover { border-color: var(--gold); transform: translateY(-5px); }
        .skill-icon { font-size: 2.5rem; margin-bottom: 10px; }
        .skill-name { font-weight: 900; color: var(--gold); font-size: 1rem; margin-bottom: 5px; }
        .skill-desc {
            font-size: 0.75rem; color: #bbb; line-height: 1.4;
            margin-bottom: 15px; height: 60px; display: flex; align-items: center;
            justify-content: center;
        }

        .skill-price {
            background: var(--gold); color: black; font-weight: 900;
            padding: 10px 15px; border-radius: 12px; cursor: pointer;
            border: none; width: 100%; transition: 0.2s; font-family: 'Cairo';
        }

        .skill-price:active { transform: scale(0.95); }
        .skill-price:disabled { background: #444; color: #888; cursor: not-allowed; }

        .inventory-badge {
            position: absolute; top: 10px; right: 10px;
            background: var(--main); color: black;
            font-size: 0.7rem; font-weight: 900;
            padding: 2px 8px; border-radius: 8px;
            box-shadow: 0 0 10px var(--main);
        }

        @media (max-width: 800px) {
            .store-grid { grid-template-columns: repeat(2, 1fr); }
        }

        .toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: white; color: black; padding: 15px 30px;
            border-radius: 50px; font-weight: 900; display: none; z-index: 2000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 2px solid var(--gold);
        }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="back-btn">â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ø§Ø­Ø©</a>
        <h1 style="margin:0; font-size: 2rem;">Ù…ØªØ¬Ø± Ø§Ù„Ø£Ø³Ù„Ø­Ø© ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª âš”ï¸</h1>
        <p style="color:#777;">Ø¬Ù‡Ø² Ù†ÙØ³Ùƒ Ù„Ù„Ù…Ù„Ø­Ù…Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</p>
        <div class="gold-status">Ø¬ÙˆÙ„Ø¯: <span id="gold-val">0</span> ğŸ’°</div>
    </header>

    <div class="store-grid">
        <div class="skill-item">
            <div class="inventory-badge" id="inv-spy">0</div>
            <div class="skill-icon">ğŸ‘ï¸</div>
            <div class="skill-name">ÙƒØ´Ù Ø§Ù„Ù…Ø³ØªÙˆØ±</div>
            <div class="skill-desc">Ø§Ù„Ø´Ø§ÙŠØ¨: Ø±Ø¤ÙŠØ© ÙˆØ±Ù‚Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† ÙŠØ¯ Ø§Ù„Ø®ØµÙ… Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØªÙŠÙ†.</div>
            <button class="skill-price" id="btn-spy" onclick="buy('spy', 150)">150 Ø¬ÙˆÙ„Ø¯</button>
        </div>

        <div class="skill-item">
            <div class="inventory-badge" id="inv-skip">0</div>
            <div class="skill-icon">ğŸƒâ€â™‚ï¸</div>
            <div class="skill-name">Ù‡Ø±ÙˆØ¨ Ø³Ø±ÙŠØ¹</div>
            <div class="skill-desc">Ø§Ù„Ù‚Ù†Ø¨Ù„Ø©: ØªØ®Ø·ÙŠ Ø¯ÙˆØ±Ùƒ ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆØªÙˆØ±ÙŠØ· Ø§Ù„Ø®ØµÙ… ÙÙŠ Ù…Ø£Ø²Ù‚ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ.</div>
            <button class="skill-price" id="btn-skip" onclick="buy('skip', 120)">120 Ø¬ÙˆÙ„Ø¯</button>
        </div>

        <div class="skill-item">
            <div class="inventory-badge" id="inv-freeze">0</div>
            <div class="skill-icon">â„ï¸</div>
            <div class="skill-name">ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø£Ø¹ØµØ§Ø¨</div>
            <div class="skill-desc">Ø§Ù„Ø³Ø±Ø¹Ø©: ØªØ¬Ù…ÙŠØ¯ Ø´Ø§Ø´Ø© Ø§Ù„Ø®ØµÙ… ÙˆÙ…Ù†Ø¹Ù‡ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨ Ù„Ù…Ø¯Ø© 3 Ø«ÙˆØ§Ù†Ù ÙƒØ§Ù…Ù„Ø©.</div>
            <button class="skill-price" id="btn-freeze" onclick="buy('freeze', 180)">180 Ø¬ÙˆÙ„Ø¯</button>
        </div>

        <div class="skill-item">
            <div class="inventory-badge" id="inv-erase">0</div>
            <div class="skill-icon">ğŸ§½</div>
            <div class="skill-name">Ø§Ù„Ø§Ø³ØªÙŠÙƒØ© Ø§Ù„Ø³Ø­Ø±ÙŠØ©</div>
            <div class="skill-desc">XO: Ù…Ø³Ø­ Ø¢Ø®Ø± Ø¹Ù„Ø§Ù…Ø© ÙˆØ¶Ø¹Ù‡Ø§ Ø§Ù„Ø®ØµÙ… ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙˆØ±Ø§Ù‹.</div>
            <button class="skill-price" id="btn-erase" onclick="buy('erase', 130)">130 Ø¬ÙˆÙ„Ø¯</button>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ - ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø·Ø§Ø¨Ù‚Ø© ØªÙ…Ø§Ù…Ø§Ù‹ Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø©
        const firebaseConfig = { databaseURL: "https://zeweil-chat-default-rtdb.europe-west1.firebasedatabase.app" };
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const mID = localStorage.getItem('arena_user_id');
        
        if (!mID) {
            alert("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù‡ÙˆÙŠØªÙƒ ÙƒÙ„Ø§Ø¹Ø¨. Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© Ø£ÙˆÙ„Ø§Ù‹.");
            window.location.href = "index.html"; 
        }

        const uRef = db.ref(`users/${mID}`);
        let currentGold = 0;

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø¬ÙˆÙ„Ø¯ ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†)
        uRef.on('value', snap => {
            const data = snap.val() || { gold: 0, skills: {} };
            currentGold = data.gold || 0;
            document.getElementById('gold-val').innerText = currentGold;
            
            const skills = data.skills || {};
            const availableSkills = ['spy', 'skip', 'freeze', 'erase'];
            
            availableSkills.forEach(id => {
                const count = skills[id] || 0;
                document.getElementById(`inv-${id}`).innerText = count;
                
                // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ø±ØµÙŠØ¯
                const btn = document.getElementById(`btn-${id}`);
                const price = parseInt(btn.innerText);
                if (currentGold < price) {
                    btn.style.background = "#333";
                    btn.style.color = "#777";
                } else {
                    btn.style.background = "var(--gold)";
                    btn.style.color = "black";
                }
            });
        });

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
        function buy(skillId, price) {
            if (currentGold < price) {
                notify("Ø°Ù‡Ø¨Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ! Ø§Ù„Ø¹Ø¨ ÙˆØ§ÙƒØ³Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ ğŸ’¸");
                return;
            }

            uRef.transaction(user => {
                if (user) {
                    if ((user.gold || 0) >= price) {
                        user.gold -= price;
                        if (!user.skills) user.skills = {};
                        user.skills[skillId] = (user.skills[skillId] || 0) + 1;
                        return user;
                    }
                }
                return; // ÙØ´Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª
            }, (error, committed, snapshot) => {
                if (committed) {
                    notify("ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡! Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø§Ù„Ø¢Ù† ÙÙŠ Ø­Ù‚ÙŠØ¨ØªÙƒ ğŸ‰");
                } else {
                    notify("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¡. Ø­Ø§ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©.");
                }
            });
        }

        function notify(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() => {
                t.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
